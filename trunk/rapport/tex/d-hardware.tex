\chapter[Design af hardware]{Hardware}
\label{ch:d-hardware}
\mnote{Nick Østergaard}

% Afsnittet skal indeholde information om vores hardware.
% Strømforsyning, motor drivere, MCU print, transducere m.m. Men kun
% hvad vi kan gøre, for at opfylde vores krav, ikke hvordan vi faktisk
% konstruerer det.

Med hensyn til hardwaren er der flere ting, der skal tages hensyn
til, hvilket er det, vi vil gøre i dette afsnit.

\section{Stepmotordriver}

Opgaven er at lave en plotter, hvilket kræver, at vi kan flytte en pen
i to retninger svarende til x- og y-akser i et plan. For at styre
disse to akser er det vigtigt, at vi nøjagtigt kan holde styr på, hvor vi
er. Til dette er stepmotor styring godt, da vi præcis ved, hvor vi er,
hver gang vi har taget et skridt.

I vores tilfælde bruger vi nogle stepmotorer fra et par
bordscannere. Motorerne er forskellig fra hinanden, da det er to vidt
forskellige scannere, de kommer fra. Da vi har to forskellige motorer,
som vi ikke kender specifikationerne på, har vi valgt, at lave et
driver print med adskilte kredsløb til hver motor. Vi opnår herved en
vis fleksibilitet, da vi på den måde kan have forskellig
forsyningsspænding til hver motor. Hvis vi havde lavet den med
sammenbyggede kredsløb, ville vi ikke kunne have forskellige
forsyningsspænding til hver motor, hvilket begge motorer måske ikke
vil køre optimalt ved.

Det skal dog lige nævnes, at den ene motor er en bipolar motor, mens
den anden er en unipolar motor. Vi vil dog styre begge motorer som
bipolare stepmotorer, fordi vi har nogle integrerede stepmotor
drivere til rådighed, som kun kan styre bipolare motorer.


\section{Sensorer}
\label{sc:sensorer}

Vi skal være i stand til at nulstille maskinens position i forhold til
vores koordinatsystem, fordi vi skal vide, hvor vi har vores
udgangspunkt.

For at opnå dette kan man gøre det, at man kører motorerne i retning
mod et nulpunkt, men kører længere end det faktisk er muligt at
køre. Det skal have til formål, at hovedet bliver trukket til
origo. Denne metode er dog ikke praktisk anvendelig, da man vil belaste
mekanikken og motorerne for meget og på den måde risikere at ødelægge
konstruktionen.

Vi vil derfor anvende nogle sensorer til at fastlægge en
nulstillingsposition. Vi kan anvende et par fotogafler, hvor vi fører
en mekanisk fane ind i. Maskinen kan så dedektere, hvornår der kommer
noget ind for sensoren, hvilket betyder, at vi ved, hvor vi er. Ud fra
hvilke signaler vi får fra de forskellige sensorer, så kan vi stoppe
maskinens bevægelse. Til sidst ved vi, at vi er i
nulstillingspositionen (origo) , altså at maskinen er nulstillet. Vi
kan herefter begynde at anvende maskinen. Det kræver selvfølgelig, at
man placerer sensorerne, således at mekanikken aldrig når at komme til
sine yderpunkter, hvor den ikke kan bevæge sig længere.


\section{SD-kort adapter}
\label{sc:sda}

Vi har i kravspecefikationen bestemt, at vi skal kunne styre maskinen
vha. data fra et SD-kort. Et SD-kort kan styres på forskellige måder:

\begin{itemize} \firmlist
\item{SPI mode (seperat serial ind eller serial ud)}
\item{Et-bit SD mode (seperat kommando og data kanaler samt et
    proprietært overførsels format)}
\item{Fire-bit SD mode (bruger ekstra forbindelser samt nogle
    ombyttede pins for at supportere fire bits bredde på parallel
    overførsel)}
\end{itemize}

Vi har valgt at kommunikere med SD-kortet via SPI-mode, da
\cite{web:captain-mmc} bruger dette og det er det simpleste jævnfør
ovennævnte som er fra \cite{web:sd-pinout}.

Som en følge af hvilken måde vi vælger at kommunikere med SD-kortet,
skal hardwaren understøtte funktionen. Der er dog ikke stor forskel imellem
SPI mode, som vi vil understøtte, og SD mode, som blot kræver to
forbindelser mere til SD-kortet. SPI er dog den simpleste
af de to.

SD-kortet opererer ved en spænding på 3,3V, derfor skal vi have en
seperat spændingsforsyning på 3,3V til kortet. Af samme grund er vi
nødt til at sænke spændingen fra vores MCU fra de 5V til omkring de
3,3V, før vi kan kommunikere med det. Vi kan opnå dette med en
spændingsdeler ved IO pinsene, der går fra MCU'en til SD-kortet. Når
signalet fra SD-kortet går høj, vil det givetvis være på 3,3V. Dette
er ikke de 5V, som vores MCU opererer ved, men det er ikke noget
problem, da det stadigvæk svarer til et højt signal for MCU'en.


\section{Tegnehoved}
\label{sc:d-tegnehoved}
Tegnehovedet er vores penholder, som sørger for, at vi kan hæve og sænke
pennen afhængig af, om vi skal tegne eller bare flytte pennen. Den kan
flyttes i to retninger (ad x- og y-aksen).

\section{Valg af MCU}
\label{sc:d-mikroprocessor}

Vi har til alle tidligere projekter brugt en AVR-processor af modellen
\texttt{ATmega16}. Under udvikling af vores software til dette projekt
er vi blevet bekymret for den lille SRAM-hukommelse, som
\texttt{ATmega16} indeholder.

Vi har lavet et andet mikroprocessorkort til en
\texttt{ATmega128}. Denne har givet os rigelig med hukommelse, og den
har også flere IO-porte end de fire \texttt{ATmega16} har. Det gør det
lettere at tilslutte andre enheder.

Vi bruger IO-porte til
\begin{enumerate} \firmlist
\item{Kontrol af stepmotorer}
\item{Evt. LCD-display}
\item{Statuslamper, knapper og til tegnehovedet}
\item{SD-kort adapteren}
\item{Sensorer}
\end{enumerate}


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../master"
%%% End: 

